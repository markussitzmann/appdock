version: '3'

services:

  base:
    image: markussitzmann/appdock_base:${APPDOCK_BUILD_LABEL}
    container_name: appdock_base
    build:
      context: base/
    networks:
      - rope
    volumes:
      - "${APPDOCK_HOME}:/home/appdock"
#
#  proxy:
#    image: markussitzmann/appdock_proxy:${APPDOCK_BUILD_LABEL}
#    container_name: appdock_proxy
#    build:
#      context: https://github.com/markussitzmann/nginx-proxy.git#appdock
#      #args:
#      #  build_label: ${APPDOCK_BUILD_LABEL}
#    networks:
#      - "rope"
#
  core:
    image: markussitzmann/appdock_core:${APPDOCK_BUILD_LABEL}
    container_name: appdock_core
    build:
      context: core/
      args:
        build_label: ${APPDOCK_BUILD_LABEL}
    depends_on:
      - base

  python:
    image: markussitzmann/appdock_python:${APPDOCK_BUILD_LABEL}
    container_name: appdock_python
    build:
      context: python/
      args:
        build_label: ${APPDOCK_BUILD_LABEL}
    depends_on:
      - core

  rdkit:
    image: markussitzmann/appdock_rdkit:${APPDOCK_BUILD_LABEL}
    container_name: appdock_rdkit
    build:
      context: rdkit/compile
      args:
        build_label: ${APPDOCK_BUILD_LABEL}
    depends_on:
      - python

  app:
    image: markussitzmann/appdock_app:${APPDOCK_BUILD_LABEL}
    container_name: appdock_app
    build:
      context: app/
      args:
        build_label: ${APPDOCK_BUILD_LABEL}
    depends_on:
      - rdkit

  shell:
    image: markussitzmann/appdock_shell:${APPDOCK_BUILD_LABEL}
    container_name: appdock_shell
    build:
      context: shell/
      args:
        build_label: ${APPDOCK_BUILD_LABEL}
    depends_on:
      - python
    command: bash

  db:
    image: markussitzmann/appdock_db:${APPDOCK_BUILD_LABEL}
    container_name: appdock_db
    build:
      context: https://github.com/markussitzmann/docker-postgresql.git#appdock
      args:
        build_label: ${APPDOCK_BUILD_LABEL}
    depends_on:
       - base

networks:
  rope:



